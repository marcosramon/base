<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escolha sua Base - 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2f5e38; /* Verde IFB */
            --secondary-color: #1a3c22;
            --accent-color: #dcb362; /* Dourado suave */
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-light);
            color: #2d3748;
        }

        h1, h2, h3 {
            font-family: 'Merriweather', serif;
            color: var(--secondary-color);
        }

        /* Anima√ß√µes e Transi√ß√µes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .base-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e2e8f0;
        }
        
        .base-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            transition: background-color 0.2s;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .ano-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .ano-1 { background-color: #c6f6d5; color: #22543d; }
        .ano-2 { background-color: #bee3f8; color: #2a4365; }
        .ano-3 { background-color: #fed7e2; color: #702459; }

        /* Estilo da Barra de Progresso Circular */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* Modal */
        .modal {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        /* Notifica√ß√µes Toast */
        #toast-container {
            z-index: 50;
        }

        .toast {
            transition: all 0.5s ease;
        }

        /* Cor Personalizada para Header do Card */
        .card-header {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="toast-container" class="fixed top-4 right-4 flex flex-col gap-2"></div>

    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://www.ifb.edu.br/images/logo_ifb.png" alt="Logo IFB" class="h-10 md:h-12">
                <div class="hidden md:block">
                    <h1 class="text-lg font-bold text-green-900 leading-tight">Escolha de Bases 2026</h1>
                    <p class="text-xs text-gray-500">EMI em Eventos - Coordena√ß√£o</p>
                </div>
            </div>
            
            <div id="user-info" class="hidden flex items-center gap-3">
                <div class="text-right hidden sm:block">
                    <p id="user-name-display" class="text-sm font-bold text-gray-800"></p>
                    <p class="text-xs text-gray-500">Logado</p>
                </div>
                <div id="user-avatar" class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-800 font-bold border border-green-200">
                    </div>
                <button onclick="logout()" class="ml-2 text-gray-500 hover:text-red-600 transition-colors" title="Sair">
                    <i class="fas fa-sign-out-alt fa-lg"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 relative">

        <div id="login-screen" class="max-w-md mx-auto mt-10 bg-white p-8 rounded-xl shadow-lg fade-in border border-gray-100">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-graduate text-2xl text-green-700"></i>
                </div>
                <h2 class="text-2xl font-bold mb-2">Bem-vinda!</h2>
                <p class="text-gray-600 text-sm">Digite sua matr√≠cula para acessar a sele√ß√£o.</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Matr√≠cula</label>
                    <input type="text" id="matricula-input" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none" 
                        placeholder="Ex: 2024..." 
                        required>
                </div>
                
                <div id="login-error" class="hidden p-3 bg-red-50 text-red-700 text-sm rounded-lg border border-red-100 flex items-center gap-2">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Matr√≠cula n√£o encontrada.</span>
                </div>

                <button type="submit" class="w-full btn-primary text-white font-bold py-3 rounded-lg shadow hover:shadow-md transition-all">
                    Entrar no Sistema
                </button>
            </form>
            
            <div class="mt-6 text-center text-xs text-gray-400">
                &copy; 2026 IFB Campus Bras√≠lia
            </div>
        </div>

        <div id="student-screen" class="hidden fade-in">
            <div class="mb-8 bg-green-50 p-6 rounded-xl border border-green-100 flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-xl font-bold text-green-800 mb-1">
                        Ol√°, <span id="student-name"></span>!
                    </h2>
                    <p class="text-green-700 text-sm">
                        Voc√™ est√° no <span id="student-year" class="font-bold bg-white px-2 py-0.5 rounded shadow-sm"></span>.
                        Confira as bases dispon√≠veis e garanta sua vaga.
                    </p>
                </div>
                <div id="status-inscricao" class="px-4 py-2 bg-white rounded-lg shadow-sm border border-gray-200 text-sm font-medium text-gray-600">
                    Nenhuma base selecionada
                </div>
            </div>

            <div id="bases-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </div>

        <div id="admin-screen" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-chart-pie text-blue-600"></i> Painel da Coordena√ß√£o
                </h2>
                <div class="flex gap-2">
                    <button onclick="exportCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow text-sm flex items-center gap-2">
                        <i class="fas fa-download"></i> Baixar Relat√≥rio (Excel)
                    </button>
                    <button onclick="resetSystem()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow text-sm flex items-center gap-2">
                        <i class="fas fa-trash-alt"></i> Resetar Sistema
                    </button>
                    <button onclick="logout()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm">
                        Sair
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">Total Inscritos</p>
                    <p id="stat-total" class="text-2xl font-bold text-gray-800">0</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">Vagas Restantes</p>
                    <p id="stat-vagas" class="text-2xl font-bold text-green-600">0</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">Bases Lotadas</p>
                    <p id="stat-lotadas" class="text-2xl font-bold text-red-500">0</p>
                </div>
                 <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">Conex√µes Ativas</p>
                    <p id="stat-conexoes" class="text-2xl font-bold text-blue-500">...</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                    <h3 class="font-bold text-gray-700">Vis√£o Geral das Bases</h3>
                    <span class="text-xs text-gray-500">Atualizado em tempo real</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm text-gray-600">
                        <thead class="bg-gray-50 text-gray-700 uppercase font-bold text-xs">
                            <tr>
                                <th class="px-6 py-3">Base / Docente</th>
                                <th class="px-6 py-3 text-center">1¬∫ Ano</th>
                                <th class="px-6 py-3 text-center">2¬∫ Ano</th>
                                <th class="px-6 py-3 text-center">3¬∫ Ano</th>
                                <th class="px-6 py-3 text-center">Total</th>
                                <th class="px-6 py-3 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody id="admin-table-body" class="divide-y divide-gray-100">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove, get, goOffline } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // Importa dados locais
        import { BASES_CONFIG, DATABASE_ALUNAS, COTAS, LIMITE_TOTAL_BASE } from './dados.js';

        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCmhqo-oO4ynkpjK87PvfvHor-eH4jZyvQ",
            authDomain: "base-2026---emi-eventos.firebaseapp.com",
            databaseURL: "https://base-2026---emi-eventos-default-rtdb.firebaseio.com",
            projectId: "base-2026---emi-eventos",
            storageBucket: "base-2026---emi-eventos.firebasestorage.app",
            messagingSenderId: "56363089069",
            appId: "1:56363089069:web:c290196230f87a321d58c3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- ESTADO DA APLICA√á√ÉO ---
        let currentUser = null;
        let inscricoesRealTime = {}; // Cache local das inscri√ß√µes do Firebase
        
        // SENHAS PROTEGIDAS (HASH BASE64)
        const ADMIN_HASH = "aWZiMjAyNnl5eg==";
        const RESET_HASH = "ZmlyZQ=="; 

        // --- FUN√á√ïES DE NAVEGA√á√ÉO ---
        window.showScreen = (screenId) => {
            ['login-screen', 'student-screen', 'admin-screen'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            
            if(screenId !== 'login-screen') {
                document.getElementById('user-info').classList.remove('hidden');
            } else {
                document.getElementById('user-info').classList.add('hidden');
            }
        };

        window.logout = () => {
            currentUser = null;
            document.getElementById('matricula-input').value = '';
            showScreen('login-screen');
        };

        // --- L√ìGICA DE DADOS (FIREBASE) ---
        
        // Listener Global: Escuta mudan√ßas no banco inteiro
        const inscricoesRef = ref(db, 'inscricoes');
        onValue(inscricoesRef, (snapshot) => {
            const data = snapshot.val() || {};
            inscricoesRealTime = data; // Atualiza cache local
            
            // Atualiza a tela dependendo de quem est√° logado
            if (currentUser) {
                renderStudentBases();
                updateUserStatus();
            } else if (!document.getElementById('admin-screen').classList.contains('hidden')) {
                renderAdminPanel();
            }
        });

        // Fun√ß√£o para Salvar Inscri√ß√£o
        function saveInscricao(inscricao) {
            const id = inscricao.matricula;
            set(ref(db, 'inscricoes/' + id), inscricao)
                .then(() => {
                    showToast(`‚úÖ Sucesso! Voc√™ escolheu a Base ${inscricao.baseId}.`);
                })
                .catch((error) => {
                    console.error("Erro:", error);
                    showToast("‚ùå Erro ao salvar. Tente novamente.");
                });
        }

        // Fun√ß√£o para Deletar Inscri√ß√£o
        function deleteInscricao(matricula) {
            remove(ref(db, 'inscricoes/' + matricula))
                .then(() => {
                    showToast("üóëÔ∏è Inscri√ß√£o cancelada. Escolha outra base.");
                })
                .catch((error) => console.error("Erro ao remover:", error));
        }

        // Fun√ß√£o Auxiliar: Conta inscritos por base e ano
        function getContagem(baseId) {
            let counts = { 1: 0, 2: 0, 3: 0, total: 0 };
            
            Object.values(inscricoesRealTime).forEach(insc => {
                if (insc.baseId == baseId) {
                    counts[insc.ano]++;
                    counts.total++;
                }
            });
            return counts;
        }

        // Fun√ß√£o Auxiliar: Verifica se usu√°rio j√° tem inscri√ß√£o
        function getInscricaoAtual() {
            if (!currentUser) return null;
            return inscricoesRealTime[currentUser.matricula] || null;
        }

        // --- RENDERIZA√á√ÉO: TELA DO ESTUDANTE ---
        window.renderStudentBases = () => {
            const container = document.getElementById('bases-grid');
            container.innerHTML = '';
            
            const inscricaoAtual = getInscricaoAtual();
            const anoUser = currentUser.ano;
            const cotaAno = COTAS[anoUser];

            BASES_CONFIG.forEach(base => {
                const counts = getContagem(base.id);
                const ocupadasAno = counts[anoUser];
                const vagasRestantesAno = cotaAno - ocupadasAno;
                const isFull = vagasRestantesAno <= 0;
                
                // Verifica se essa √© a base escolhida pelo usu√°rio
                const isSelected = inscricaoAtual && inscricaoAtual.baseId == base.id;
                // Verifica se usu√°rio tem base escolhida em OUTRO lugar (para bloquear bot√µes)
                const hasOtherSelection = inscricaoAtual && !isSelected;

                // Estilo do Cart√£o
                let cardClass = "base-card bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md relative flex flex-col";
                let btnClass = "w-full py-3 font-bold transition-all";
                let btnText = "Selecionar Base";
                let btnDisabled = false;
                let btnColor = "btn-primary text-white";

                if (isSelected) {
                    cardClass += " ring-2 ring-green-500 ring-offset-2";
                    btnText = "Sair da Base (Liberar Vaga)";
                    btnColor = "bg-red-500 hover:bg-red-600 text-white";
                } else if (hasOtherSelection) {
                    btnText = "Voc√™ j√° tem uma base";
                    btnDisabled = true;
                    btnColor = "bg-gray-100 text-gray-400 cursor-not-allowed";
                } else if (isFull) {
                    cardClass += " opacity-75 grayscale-[0.5]";
                    btnText = "Lotada para seu ano";
                    btnDisabled = true;
                    btnColor = "bg-gray-200 text-gray-500 cursor-not-allowed";
                }

                // HTML do Cart√£o
                const card = document.createElement('div');
                card.className = cardClass;
                card.innerHTML = `
                    <div class="card-header p-4">
                        <h3 class="text-xl font-bold text-white mb-1">${base.nome}</h3>
                        <p class="text-green-100 text-sm font-light">${base.docente}</p>
                    </div>
                    
                    <div class="p-5 flex-grow">
                        <div class="mb-4 text-center">
                            <span class="text-xs font-bold text-gray-500 uppercase tracking-wide">Vagas para o ${anoUser}¬∫ Ano</span>
                            <div class="flex justify-center items-end gap-1 mt-1">
                                <span class="text-3xl font-bold ${isFull ? 'text-red-500' : 'text-green-600'}">${ocupadasAno}</span>
                                <span class="text-gray-400 text-sm mb-1">/ ${cotaAno}</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                <div class="h-2 rounded-full ${isFull ? 'bg-red-500' : 'bg-green-500'}" 
                                     style="width: ${(ocupadasAno/cotaAno)*100}%"></div>
                            </div>
                        </div>

                        <div class="flex justify-between text-xs text-gray-400 border-t pt-3 mt-2">
                            <span>Total na base: ${counts.total} / ${LIMITE_TOTAL_BASE}</span>
                            <span>Status: ${isFull ? 'Cheia' : 'Dispon√≠vel'}</span>
                        </div>
                    </div>

                    <button 
                        onclick="${isSelected ? `removeInscricao('${currentUser.matricula}')` : `selectBase(${base.id})`}"
                        class="${btnClass} ${btnColor}"
                        ${btnDisabled ? 'disabled' : ''}>
                        ${btnText}
                    </button>
                `;
                container.appendChild(card);
            });
        };

        window.updateUserStatus = () => {
            const div = document.getElementById('status-inscricao');
            const insc = getInscricaoAtual();
            
            if (insc) {
                const base = BASES_CONFIG.find(b => b.id == insc.baseId);
                div.innerHTML = `<i class="fas fa-check-circle text-green-500 mr-2"></i> Inscrito na <strong>${base.nome}</strong>`;
                div.className = "px-4 py-2 bg-green-50 rounded-lg shadow-sm border border-green-200 text-sm text-green-800";
            } else {
                div.innerHTML = `<i class="fas fa-info-circle text-blue-500 mr-2"></i> Nenhuma base selecionada`;
                div.className = "px-4 py-2 bg-white rounded-lg shadow-sm border border-gray-200 text-sm text-gray-500";
            }
        }

        // --- A√á√ïES DO ESTUDANTE ---
        window.selectBase = function(baseId) {
            if (getInscricaoAtual()) return;

            const novaInscricao = {
                matricula: currentUser.matricula,
                nome: currentUser.nome,
                ano: currentUser.ano,
                baseId: baseId,
                dataSelecao: new Date().toISOString()
            };
            
            saveInscricao(novaInscricao);
        }

        window.removeInscricao = function(matricula) {
            if(confirm('Tem certeza que deseja remover esta estudante da base? A vaga ser√° liberada imediatamente.')) {
                deleteInscricao(matricula);
            }
        }

        // --- LOGIN & INICIALIZA√á√ÉO ---
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const matInput = document.getElementById('matricula-input').value.trim();

            // 1. Verifica se √© ADMIN (Compara o HASH Base64)
            // btoa() transforma o que foi digitado em Base64 para comparar com o segredo
            if (typeof ADMIN_HASH !== 'undefined' && btoa(matInput) === ADMIN_HASH) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-screen').classList.remove('hidden');
                renderAdminPanel();
                return;
            }

            // 2. Verifica se √© ESTUDANTE
            const alunaEncontrada = DATABASE_ALUNAS.find(a => a.matricula === matInput);

            if (alunaEncontrada) {
                currentUser = alunaEncontrada;
                document.getElementById('login-error').classList.add('hidden');
                document.getElementById('user-avatar').textContent = currentUser.nome.charAt(0);
                document.getElementById('user-name-display').innerHTML = `${currentUser.nome} <span class="ano-badge ano-${currentUser.ano}">${currentUser.ano}¬∫ Ano</span>`;
                
                showScreen('student-screen');
                updateUserStatus();
                renderStudentBases();
            } else {
                // MENSAGEM DE ERRO ATUALIZADA
                const errorDiv = document.getElementById('login-error');
                errorDiv.innerHTML = "‚ùå <strong>Matr√≠cula n√£o encontrada!</strong><br>Acesse o SUAP Ensino ou procure a coordena√ß√£o, caso n√£o saiba o n√∫mero de sua matr√≠cula.";
                errorDiv.classList.remove('hidden');
            }
        });

        // --- PAINEL ADMIN ---
        window.renderAdminPanel = () => {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = '';
            
            let totalInscritos = 0;
            let basesLotadas = 0;

            BASES_CONFIG.forEach(base => {
                const counts = getContagem(base.id);
                totalInscritos += counts.total;
                
                // Calcula ocupa√ß√£o visual (barra de progresso simples)
                const percent = (counts.total / LIMITE_TOTAL_BASE) * 100;
                let statusColor = "bg-green-100 text-green-800";
                if (percent > 80) statusColor = "bg-yellow-100 text-yellow-800";
                if (percent >= 100) {
                    statusColor = "bg-red-100 text-red-800";
                    basesLotadas++;
                }

                const row = `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 border-b border-gray-100">
                            <p class="font-bold text-gray-800">${base.nome}</p>
                            <p class="text-xs text-gray-500">${base.docente}</p>
                        </td>
                        <td class="px-6 py-4 border-b border-gray-100 text-center font-mono">
                            <span class="${counts[1] >= COTAS[1] ? 'text-red-600 font-bold' : ''}">${counts[1]}/${COTAS[1]}</span>
                        </td>
                        <td class="px-6 py-4 border-b border-gray-100 text-center font-mono">
                            <span class="${counts[2] >= COTAS[2] ? 'text-red-600 font-bold' : ''}">${counts[2]}/${COTAS[2]}</span>
                        </td>
                        <td class="px-6 py-4 border-b border-gray-100 text-center font-mono">
                            <span class="${counts[3] >= COTAS[3] ? 'text-red-600 font-bold' : ''}">${counts[3]}/${COTAS[3]}</span>
                        </td>
                        <td class="px-6 py-4 border-b border-gray-100 text-center">
                            <div class="flex items-center justify-center gap-2">
                                <span class="font-bold">${counts.total}</span>
                                <span class="text-xs text-gray-400">/ ${LIMITE_TOTAL_BASE}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 border-b border-gray-100 text-center">
                            <span class="px-2 py-1 rounded text-xs font-bold ${statusColor}">
                                ${percent.toFixed(0)}%
                            </span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Atualiza Cards de Estat√≠stica
            document.getElementById('stat-total').textContent = totalInscritos;
            document.getElementById('stat-vagas').textContent = (BASES_CONFIG.length * LIMITE_TOTAL_BASE) - totalInscritos;
            document.getElementById('stat-lotadas').textContent = basesLotadas;
        };

        // Fun√ß√£o para Exportar Excel (CSV)
        window.exportCSV = () => {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Matricula,Nome,Ano,Base Selecionada,Data/Hora\n";

            Object.values(inscricoesRealTime).forEach(insc => {
                const base = BASES_CONFIG.find(b => b.id == insc.baseId);
                const baseNome = base ? base.nome : "Desconhecida";
                csvContent += `${insc.matricula},"${insc.nome}",${insc.ano},"${baseNome}",${insc.dataSelecao}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "relatorio_bases_2026.csv");
            document.body.appendChild(link);
            link.click();
        };

        // Fun√ß√£o de Reset Geral (Perigosa)
        window.resetSystem = function() {
            // 1. Pede a senha de seguran√ßa (RESET_HASH)
            const senhaConfirmacao = prompt("‚ö†Ô∏è ZONA DE PERIGO ‚ö†Ô∏è\n\nEsta a√ß√£o apagar√° TODOS os dados do servidor permanentemente.\n\nPara confirmar, digite a SENHA DE RESET (senha de seguran√ßa):");

            // 2. Se cancelar, para tudo
            if (senhaConfirmacao === null) return;

            // 3. Verifica senha usando Hash Base64
            if (btoa(senhaConfirmacao) === RESET_HASH) {
                alert("Senha confirmada! O download do backup iniciar√° agora.");
                exportCSV(); // Garante o backup antes
                
                setTimeout(() => {
                    window.deleteAllData(); // Chama a fun√ß√£o que deleta de verdade
                }, 1500);
            } else {
                alert("‚õî Senha incorreta! O reset foi cancelado.");
            }
        }

        // Fun√ß√£o interna para limpar o banco
        window.deleteAllData = () => {
             set(ref(db, 'inscricoes'), {})
                .then(() => {
                    alert("Sistema resetado com sucesso. O banco de dados est√° vazio.");
                    location.reload();
                })
                .catch((e) => alert("Erro ao limpar: " + e));
        };

        // --- SISTEMA DE NOTIFICA√á√ÉO (TOAST) ---
        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = "toast bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 transform translate-x-full opacity-0";
            toast.innerHTML = message;
            
            container.appendChild(toast);
            
            // Anima√ß√£o Entrada
            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            });

            // Remove depois de 3s
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

         // ============================================
        // üõ°Ô∏è SISTEMA DE AUTO-LOGOUT (INATIVIDADE)
        // ============================================
        let tempoInatividade;
        const LIMITE_MINUTOS = 2; 
        const TEMPO_LIMITE = LIMITE_MINUTOS * 60 * 1000; // Converte para milissegundos

        function resetarTimer() {
            clearTimeout(tempoInatividade);
            
            tempoInatividade = setTimeout(() => {
                // Tenta desconectar do Firebase antes de sair
                try { goOffline(db); } catch(e) {} 

                // Redireciona para o site do IFB
                alert("‚è≥ Sess√£o expirada por inatividade.\nVoc√™ ser√° redirecionada.");
                window.location.href = "https://www.ifb.edu.br";
            }, TEMPO_LIMITE);
        }

        // Monitora qualquer movimento para saber que a pessoa ainda est√° ali
        ['mousemove', 'keypress', 'click', 'scroll', 'touchstart'].forEach(evento => {
            document.addEventListener(evento, resetarTimer);
        });

        // Inicia o contador assim que a p√°gina carrega
        resetarTimer();

    </script>
</body>
</html>
